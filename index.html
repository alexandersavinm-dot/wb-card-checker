<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Card Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .url-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #5568d3;
        }
        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            margin: 20px 0;
        }
        .result {
            margin-top: 30px;
            display: none;
        }
        .result.show {
            display: block;
        }
        .rating-box {
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            margin: 20px 0;
        }
        .recommendation {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }
        .recommendation.critical {
            border-left-color: #e74c3c;
        }
        .recommendation.warning {
            border-left-color: #f39c12;
        }
        .recommendation.ok {
            border-left-color: #27ae60;
        }
        .error {
            background: #ffe6e6;
            color: #c33;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç WB Card Analyzer</h1>
        <p style="text-align: center; color: #666;">–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É Wildberries –∏ –ø–æ–ª—É—á–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏</p>
        
        <div class="url-input-group">
            <input type="text" id="urlInput" placeholder="https://www.wildberries.ru/catalog/..." required>
            <button onclick="analyzeCard()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        
        <div class="loading" id="loading">‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∫–∞—Ä—Ç–æ—á–∫—É...</div>
        <div class="error" id="error" style="display: none;"></div>
        
        <div class="result" id="result">
            <div class="rating-box" id="ratingBox"></div>
            <div id="recommendations"></div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://wb-parser-backend.onrender.com'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É —Å—Å—ã–ª–∫—É!

        function analyzeCard() {
            const url = document.getElementById('urlInput').value.trim();
            
            if (!url) {
                showError('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É');
                return;
            }
            
            if (!url.includes('wildberries.ru')) {
                showError('–≠—Ç–æ –Ω–µ —Å—Å—ã–ª–∫–∞ –Ω–∞ Wildberries');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('result').classList.remove('show');

            fetch(`${BACKEND_URL}/parse?url=${encodeURIComponent(url)}`)
                .then(res => res.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    
                    if (data.error) {
                        showError(data.error);
                        return;
                    }
                    
                    displayAnalysis(data.data);
                })
                .catch(err => {
                    document.getElementById('loading').style.display = 'none';
                    showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + err.message);
                });
        }

        function displayAnalysis(data) {
            let score = 0;
            const recommendations = [];

            // –ù–∞–∑–≤–∞–Ω–∏–µ
            if (data.title && data.title.length > 50) {
                score += 10;
            } else {
                score += 5;
                recommendations.push({
                    level: 'warning',
                    text: '‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ: ' + (data.title ? '–º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ' : '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ')
                });
            }

            // –§–æ—Ç–æ
            if (data.photos >= 7) {
                score += 15;
            } else if (data.photos >= 5) {
                score += 10;
                recommendations.push({
                    level: 'warning',
                    text: '‚ö†Ô∏è –§–æ—Ç–æ: –µ—Å—Ç—å ' + data.photos + ', –Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 7'
                });
            } else {
                score += 5;
                recommendations.push({
                    level: 'critical',
                    text: '‚ùå –§–æ—Ç–æ: —Ç–æ–ª—å–∫–æ ' + data.photos + ', –¥–æ–±–∞–≤—å—Ç–µ –¥–æ 7-10'
                });
            }

            // –û–ø–∏—Å–∞–Ω–∏–µ
            if (data.description && data.description.length > 300) {
                score += 15;
            } else if (data.description && data.description.length > 100) {
                score += 8;
                recommendations.push({
                    level: 'warning',
                    text: '‚ö†Ô∏è –û–ø–∏—Å–∞–Ω–∏–µ: —Ä–∞—Å—à–∏—Ä—å—Ç–µ –¥–æ 300+ —Å–∏–º–≤–æ–ª–æ–≤'
                });
            } else {
                score += 3;
                recommendations.push({
                    level: 'critical',
                    text: '‚ùå –û–ø–∏—Å–∞–Ω–∏–µ: —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–ª–∏ –ø—É—Å—Ç–æ–µ'
                });
            }

            // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            if (data.characteristics >= 10) {
                score += 15;
            } else if (data.characteristics >= 5) {
                score += 8;
                recommendations.push({
                    level: 'warning',
                    text: '‚ö†Ô∏è –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ' + data.characteristics + ', –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ'
                });
            } else {
                recommendations.push({
                    level: 'critical',
                    text: '‚ùå –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Ç–æ–ª—å–∫–æ ' + data.characteristics
                });
            }

            // –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
            const rating = parseFloat(data.rating) || 0;
            if (rating >= 4.3) {
                score += 15;
            } else if (rating >= 4.0) {
                score += 10;
                recommendations.push({
                    level: 'warning',
                    text: '‚ö†Ô∏è –†–µ–π—Ç–∏–Ω–≥: ' + rating + ', –Ω—É–∂–µ–Ω –º–∏–Ω–∏–º—É–º 4.3'
                });
            } else {
                recommendations.push({
                    level: 'critical',
                    text: '‚ùå –†–µ–π—Ç–∏–Ω–≥: ' + rating + ', –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π'
                });
            }

            const reviews = parseInt(data.reviewCount) || 0;
            if (reviews >= 10) {
                score += 15;
            } else if (reviews >= 5) {
                score += 8;
                recommendations.push({
                    level: 'warning',
                    text: '‚ö†Ô∏è –û—Ç–∑—ã–≤—ã: –≤—Å–µ–≥–æ ' + reviews + ', –Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 10'
                });
            } else {
                recommendations.push({
                    level: 'critical',
                    text: '‚ùå –û—Ç–∑—ã–≤—ã: –≤—Å–µ–≥–æ ' + reviews + ', —Å—Ä–æ—á–Ω–æ —Å–æ–±–µ—Ä–∏—Ç–µ –æ—Ç–∑—ã–≤—ã'
                });
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ü–µ–Ω–∫—É
            let grade = 'A';
            if (score < 75) grade = 'B';
            if (score < 60) grade = 'C';
            if (score < 40) grade = 'D';

            document.getElementById('ratingBox').textContent = grade + ' (' + score + '/100)';

            let html = '<h3>üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:</h3>';
            
            if (recommendations.length === 0) {
                html += '<div class="recommendation ok">‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–ª–∏—á–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞! –ì–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∫–ª–∞–º–µ.</div>';
            } else {
                recommendations.forEach(rec => {
                    html += `<div class="recommendation ${rec.level}">${rec.text}</div>`;
                });
            }

            document.getElementById('recommendations').innerHTML = html;
            document.getElementById('result').classList.add('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // –ù–∞–∂–∞—Ç–∏–µ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') analyzeCard();
        });
    </script>
</body>
</html>
